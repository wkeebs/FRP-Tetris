var Ne=Object.defineProperty;var Je=(t,e,n)=>e in t?Ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var h=(t,e,n)=>(Je(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var J=function(t,e){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},J(t,e)};function M(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");J(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Qe(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function s(l){try{u(r.next(l))}catch(m){c(m)}}function a(l){try{u(r.throw(l))}catch(m){c(m)}}function u(l){l.done?o(l.value):i(l.value).then(s,a)}u((r=r.apply(t,e||[])).next())})}function Se(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,c;return c={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(u){return function(l){return a([u,l])}}function a(u){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,u[0]&&(n=0)),n;)try{if(r=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1],o=u;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(u);break}o[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(l){u=[6,l],i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function B(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(s){c={error:s}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return o}function O(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function D(t){return this instanceof D?(this.v=t,this):new D(t)}function ze(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(v){r[v]&&(i[v]=function(f){return new Promise(function(p,y){o.push([v,f,p,y])>1||s(v,f)})})}function s(v,f){try{a(r[v](f))}catch(p){m(o[0][3],p)}}function a(v){v.value instanceof D?Promise.resolve(v.value.v).then(u,l):m(o[0][2],v)}function u(v){s("next",v)}function l(v){s("throw",v)}function m(v,f){v(f),o.shift(),o.length&&s(o[0][0],o[0][1])}}function et(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof B=="function"?B(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(s,a){c=t[o](c),i(s,a,c.done,c.value)})}}function i(o,c,s,a){Promise.resolve(a).then(function(u){o({value:u,done:s})},c)}}function b(t){return typeof t=="function"}function tt(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var K=tt(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Q(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Y=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var s=B(c),a=s.next();!a.done;a=s.next()){var u=a.value;u.remove(this)}}catch(y){e={error:y}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}else c.remove(this);var l=this.initialTeardown;if(b(l))try{l()}catch(y){o=y instanceof K?y.errors:[y]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var v=B(m),f=v.next();!f.done;f=v.next()){var p=f.value;try{le(p)}catch(y){o=o??[],y instanceof K?o=O(O([],A(o)),A(y.errors)):o.push(y)}}}catch(y){r={error:y}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}}if(o)throw new K(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)le(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Q(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Q(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();Y.EMPTY;function we(t){return t instanceof Y||t&&"closed"in t&&b(t.remove)&&b(t.add)&&b(t.unsubscribe)}function le(t){b(t)?t():t.unsubscribe()}var Ee={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},z={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=z.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,O([t,e],A(n))):setTimeout.apply(void 0,O([t,e],A(n)))},clearTimeout:function(t){var e=z.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function Ie(t){z.setTimeout(function(){throw t})}function fe(){}function nt(t){t()}var re=function(t){M(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,we(n)&&n.add(r)):r.destination=ct,r}return e.create=function(n,r,i){return new ee(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Y),rt=Function.prototype.bind;function j(t,e){return rt.call(t,e)}var it=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){V(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){V(r)}else V(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){V(n)}},t}(),ee=function(t){M(e,t);function e(n,r,i){var o=t.call(this)||this,c;if(b(n)||!n)c={next:n??void 0,error:r??void 0,complete:i??void 0};else{var s;o&&Ee.useDeprecatedNextContext?(s=Object.create(n),s.unsubscribe=function(){return o.unsubscribe()},c={next:n.next&&j(n.next,s),error:n.error&&j(n.error,s),complete:n.complete&&j(n.complete,s)}):c=n}return o.destination=new it(c),o}return e}(re);function V(t){Ie(t)}function ot(t){throw t}var ct={closed:!0,next:fe,error:ot,complete:fe},ie=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ge(t){return t}function st(t){return t.length===0?ge:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var S=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,o=at(e)?e:new ee(e,n,r);return nt(function(){var c=i,s=c.operator,a=c.source;o.add(s?s.call(o,a):a?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=de(n),new n(function(i,o){var c=new ee({next:function(s){try{e(s)}catch(a){o(a),c.unsubscribe()}},error:o,complete:i});r.subscribe(c)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[ie]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return st(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=de(e),new e(function(r,i){var o;n.subscribe(function(c){return o=c},function(c){return i(c)},function(){return r(o)})})},t.create=function(e){return new t(e)},t}();function de(t){var e;return(e=t??Ee.Promise)!==null&&e!==void 0?e:Promise}function ut(t){return t&&b(t.next)&&b(t.error)&&b(t.complete)}function at(t){return t&&t instanceof re||ut(t)&&we(t)}function lt(t){return b(t==null?void 0:t.lift)}function U(t){return function(e){if(lt(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function R(t,e,n,r,i){return new ft(t,e,n,r,i)}var ft=function(t){M(e,t);function e(n,r,i,o,c,s){var a=t.call(this,n)||this;return a.onFinalize=c,a.shouldUnsubscribe=s,a._next=r?function(u){try{r(u)}catch(l){n.error(l)}}:t.prototype._next,a._error=o?function(u){try{o(u)}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(re),xe={now:function(){return(xe.delegate||Date).now()},delegate:void 0},dt=function(t){M(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Y),G={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=G.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,O([t,e],A(n))):setInterval.apply(void 0,O([t,e],A(n)))},clearInterval:function(t){var e=G.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},ht=function(t){M(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,c=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(c,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(c,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),G.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&G.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,o;try{this.work(n)}catch(c){i=!0,o=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Q(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(dt),he=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=xe.now,t}(),vt=function(t){M(e,t);function e(n,r){r===void 0&&(r=he.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(he),Ce=new vt(ht),pt=Ce,yt=new S(function(t){return t.complete()});function Pe(t){return t&&b(t.schedule)}function Ae(t){return t[t.length-1]}function mt(t){return Pe(Ae(t))?t.pop():void 0}function bt(t,e){return typeof Ae(t)=="number"?t.pop():e}var oe=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function _e(t){return b(t==null?void 0:t.then)}function Te(t){return b(t[ie])}function Oe(t){return Symbol.asyncIterator&&b(t==null?void 0:t[Symbol.asyncIterator])}function Le(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function St(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var He=St();function De(t){return b(t==null?void 0:t[He])}function Re(t){return ze(this,arguments,function(){var n,r,i,o;return Se(this,function(c){switch(c.label){case 0:n=t.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,D(n.read())];case 3:return r=c.sent(),i=r.value,o=r.done,o?[4,D(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,D(i)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Me(t){return b(t==null?void 0:t.getReader)}function L(t){if(t instanceof S)return t;if(t!=null){if(Te(t))return wt(t);if(oe(t))return Et(t);if(_e(t))return It(t);if(Oe(t))return Ue(t);if(De(t))return gt(t);if(Me(t))return xt(t)}throw Le(t)}function wt(t){return new S(function(e){var n=t[ie]();if(b(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Et(t){return new S(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function It(t){return new S(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Ie)})}function gt(t){return new S(function(e){var n,r;try{for(var i=B(t),o=i.next();!o.done;o=i.next()){var c=o.value;if(e.next(c),e.closed)return}}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Ue(t){return new S(function(e){Ct(t,e).catch(function(n){return e.error(n)})})}function xt(t){return Ue(Re(t))}function Ct(t,e){var n,r,i,o;return Qe(this,void 0,void 0,function(){var c,s;return Se(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),n=et(t),a.label=1;case 1:return[4,n.next()];case 2:if(r=a.sent(),!!r.done)return[3,4];if(c=r.value,e.next(c),e.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=a.sent(),i={error:s},[3,11];case 6:return a.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function P(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(o),!i)return o}function ke(t,e){return e===void 0&&(e=0),U(function(n,r){n.subscribe(R(r,function(i){return P(r,t,function(){return r.next(i)},e)},function(){return P(r,t,function(){return r.complete()},e)},function(i){return P(r,t,function(){return r.error(i)},e)}))})}function Xe(t,e){return e===void 0&&(e=0),U(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Pt(t,e){return L(t).pipe(Xe(e),ke(e))}function At(t,e){return L(t).pipe(Xe(e),ke(e))}function _t(t,e){return new S(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Tt(t,e){return new S(function(n){var r;return P(n,e,function(){r=t[He](),P(n,e,function(){var i,o,c;try{i=r.next(),o=i.value,c=i.done}catch(s){n.error(s);return}c?n.complete():n.next(o)},0,!0)}),function(){return b(r==null?void 0:r.return)&&r.return()}})}function Be(t,e){if(!t)throw new Error("Iterable cannot be null");return new S(function(n){P(n,e,function(){var r=t[Symbol.asyncIterator]();P(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Ot(t,e){return Be(Re(t),e)}function Lt(t,e){if(t!=null){if(Te(t))return Pt(t,e);if(oe(t))return _t(t,e);if(_e(t))return At(t,e);if(Oe(t))return Be(t,e);if(De(t))return Tt(t,e);if(Me(t))return Ot(t,e)}throw Le(t)}function Ht(t,e){return e?Lt(t,e):L(t)}function Dt(t){return t instanceof Date&&!isNaN(t)}function k(t,e){return U(function(n,r){var i=0;n.subscribe(R(r,function(o){r.next(t.call(e,o,i++))}))})}var Rt=Array.isArray;function Mt(t,e){return Rt(e)?t.apply(void 0,O([],A(e))):t(e)}function Ut(t){return k(function(e){return Mt(t,e)})}function kt(t,e,n,r,i,o,c,s){var a=[],u=0,l=0,m=!1,v=function(){m&&!a.length&&!u&&e.complete()},f=function(y){return u<r?p(y):a.push(y)},p=function(y){o&&e.next(y),u++;var g=!1;L(n(y,l++)).subscribe(R(e,function(_){i==null||i(_),o?f(_):e.next(_)},function(){g=!0},void 0,function(){if(g)try{u--;for(var _=function(){var H=a.shift();c?P(e,c,function(){return p(H)}):p(H)};a.length&&u<r;)_();v()}catch(H){e.error(H)}}))};return t.subscribe(R(e,f,function(){m=!0,v()})),function(){s==null||s()}}function ce(t,e,n){return n===void 0&&(n=1/0),b(e)?ce(function(r,i){return k(function(o,c){return e(r,o,i,c)})(L(t(r,i)))},n):(typeof e=="number"&&(n=e),U(function(r,i){return kt(r,i,t,n)}))}function Xt(t){return t===void 0&&(t=1/0),ce(ge,t)}var Bt=["addListener","removeListener"],Zt=["addEventListener","removeEventListener"],Vt=["on","off"];function Z(t,e,n,r){if(b(n)&&(r=n,n=void 0),r)return Z(t,e,n).pipe(Ut(r));var i=A(Wt(t)?Zt.map(function(s){return function(a){return t[s](e,a,n)}}):$t(t)?Bt.map(ve(t,e)):Gt(t)?Vt.map(ve(t,e)):[],2),o=i[0],c=i[1];if(!o&&oe(t))return ce(function(s){return Z(s,e,n)})(L(t));if(!o)throw new TypeError("Invalid event target");return new S(function(s){var a=function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];return s.next(1<u.length?u:u[0])};return o(a),function(){return c(a)}})}function ve(t,e){return function(n){return function(r){return t[n](e,r)}}}function $t(t){return b(t.addListener)&&b(t.removeListener)}function Gt(t){return b(t.on)&&b(t.off)}function Wt(t){return b(t.addEventListener)&&b(t.removeEventListener)}function qt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=pt);var r=-1;return e!=null&&(Pe(e)?n=e:r=e),new S(function(i){var o=Dt(t)?+t-n.now():t;o<0&&(o=0);var c=0;return n.schedule(function(){i.closed||(i.next(c++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function Ze(t,e){return t===void 0&&(t=0),e===void 0&&(e=Ce),t<0&&(t=0),qt(t,t,e)}function se(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=mt(t),r=bt(t,1/0),i=t;return i.length?i.length===1?L(i[0]):Xt(r)(Ht(i,n)):yt}function Ve(t,e){return U(function(n,r){var i=0;n.subscribe(R(r,function(o){return t.call(e,o,i++)&&r.next(o)}))})}function Ft(t,e,n,r,i){return function(o,c){var s=n,a=e,u=0;o.subscribe(R(c,function(l){var m=u++;a=s?t(a,l,m):(s=!0,l),r&&c.next(a)},i&&function(){s&&c.next(a),c.complete()}))}}function ue(t,e){return U(Ft(t,e,arguments.length>=2,!0))}const E={CANVAS_WIDTH:200,CANVAS_HEIGHT:400,PREVIEW_WIDTH:160,PREVIEW_HEIGHT:120},d={TICK_RATE_MS:10,GRID_WIDTH:10,GRID_HEIGHT:20,CUBE_SIZE_PX:20,PIECE_SIZE:4,ROW_WIDTH:10,LEVEL_GOAL:4,START_FALL_RATE_MS:400,FALL_RATE_LIMIT_MS:100},$={WIDTH:E.CANVAS_WIDTH/d.GRID_WIDTH,HEIGHT:E.CANVAS_HEIGHT/d.GRID_HEIGHT},T=class T{};h(T,"JLSTZ_OffsetData",[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[1,0],[0,0],[-1,0]],[[0,0],[1,1],[0,0],[-1,1]],[[0,0],[0,-2],[0,0],[0,-2]],[[0,0],[1,-2],[0,0],[-1,-2]]]),h(T,"I_OffsetData",[[[0,0],[-2,0],[-1,-1],[0,-1]],[[-1,0],[0,0],[1,-1],[0,-1]],[[1,0],[0,1],[-2,-1],[0,-1]],[[-1,0],[0,-1],[1,0],[0,1]],[[2,0],[0,2],[-2,0],[0,-2]]]),h(T,"getOffset",e=>e==="I"?T.I_OffsetData:T.JLSTZ_OffsetData);let te=T;function X(t,e,n){return Z(document,t).pipe(Ve(({code:r})=>r===e),k(n))}const w=class w{};h(w,"m",2147483648),h(w,"a",1103515245),h(w,"c",12345),h(w,"hash",e=>(w.a*e+w.c)%w.m),h(w,"scale",e=>n=>(2*e/(w.m-1)-1)*n%n);let W=w;function Yt(t,e){return function(r=0){return t.pipe(ue((o,c)=>W.scale(W.hash(o+c*r))(e)))}}const pe=t=>e=>t.filter(n=>!e.includes(n)),Kt=(t,e)=>(t%e+e)%e;function jt(t){return t!=null}const Nt=t=>e=>t.y===e.y?t.x<e.x?t.x===e.x-d.CUBE_SIZE_PX:e.x===t.x-d.CUBE_SIZE_PX:!1,$e=t=>e=>t.x===e.x&&t.y+d.CUBE_SIZE_PX===e.y,ye=t=>e=>{const n=e.x<=E.CANVAS_WIDTH-d.CUBE_SIZE_PX&&e.x>=0,r=e.y<=E.CANVAS_HEIGHT-d.CUBE_SIZE_PX,i=t.staticCubes.some(o=>e.x===o.x&&e.y===o.y);return n&&r&&!i},Jt=t=>t===1?40:t===2?100:t===3?300:t===4?1200:0,me=(t,e,n={})=>{const r=document.createElementNS(t,e);return Object.entries(n).forEach(([i,o])=>r.setAttribute(i,o)),r},N=t=>{t?(t instanceof SVGGraphicsElement&&t.setAttribute("visibility","visible"),t.classList.remove("hidden"),t.parentNode.appendChild(t)):console.log("elem not found")},q=t=>{t&&(t instanceof SVGGraphicsElement&&t.setAttribute("visibility","hidden"),t.classList.add("hidden"))},Qt=()=>{const t=document.querySelector("#svgCanvas"),e=document.querySelector("#gameOver"),n=document.querySelector("#restart");t.innerHTML="",t.appendChild(e),q(e),q(n)},zt=t=>{const e=document.querySelector("#highScoreText"),n=e.innerText;e.innerText=t>Number(n)?String(t):n,console.log(t,e.innerText)},en=()=>{const t=document.querySelector("#svgCanvas"),e=document.querySelector("#svgPreview");t.setAttribute("height",`${E.CANVAS_HEIGHT}`),t.setAttribute("width",`${E.CANVAS_WIDTH}`),e.setAttribute("height",`${E.PREVIEW_HEIGHT}`),e.setAttribute("width",`${E.PREVIEW_WIDTH}`)},tn=t=>e=>{const n=document.querySelector("#svgCanvas"),r=document.querySelector("#svgPreview"),i=document.querySelector("#gameOver"),o=document.querySelector("#main"),c=document.querySelector("#restart"),s=document.querySelector("#levelText"),a=document.querySelector("#scoreText");if(document.querySelector("#highScoreText"),!n||!r)return;r.querySelectorAll('rect[color= "none"]').forEach(f=>{try{console.log("removed transparent cube"),n.removeChild(f)}catch{}});const m=(f=>p=>{const y=document.getElementById(String(p.id));if(y)y.setAttribute("x",String(p.x)),y.setAttribute("y",String(p.y));else{const g=me(f.namespaceURI,"rect",{height:`${$.HEIGHT}`,width:`${$.WIDTH}`,x:`${p.x}`,y:`${p.y}`,style:`fill: ${p.colour}`});g.setAttribute("id",String(p.id)),f.appendChild(g)}})(n);e.staticCubes.forEach(m),e.piece.cubes.forEach(m),e.dropPreview.forEach(m),r.innerHTML="",Ge(ae)(e.nextPiece.shape).cubes.forEach(f=>{const p=me(r.namespaceURI,"rect",{height:`${$.HEIGHT}`,width:`${$.WIDTH}`,x:`${f.x-10}`,y:`${f.y+60}`,style:`fill: ${f.colour}`});p.setAttribute("id",String(f.id)),r.appendChild(p)}),zt(e.highScore),e.exit.map(f=>document.getElementById(String(f.id))).filter(jt).forEach(f=>{try{n.removeChild(f)}catch{console.log("Already removed: "+f.id)}}),s.innerHTML=String(e.level),a.innerHTML=String(e.score),e.gameEnd?(N(i),c.innerText="Restart Game",N(c),t()):(N(o),q(i),q(c))},C={x:60,y:-20},be={rotationAxis:{x:0,y:0},cubes:[],shape:"O",rotationIndex:0},ae={gameEnd:!1,currentId:0,piece:be,nextPiece:be,staticCubes:[],exit:[],score:0,fallRateMs:300,level:1,levelProgress:0,highScore:0,tickProgress:0,dropPreview:[]},Ge=t=>e=>{const n=f=>p=>(y,g)=>({id:p,x:y,y:g,colour:f}),r=n("cyan"),i=n("blue"),o=n("orange"),c=n("yellow"),s=n("green"),a=n("purple"),u=n("red"),l=f=>(p,y)=>(g,_)=>(H,Ye)=>(Ke,je)=>[f(t.currentId+1)(C.x+p*d.CUBE_SIZE_PX,C.y+y*d.CUBE_SIZE_PX),f(t.currentId+2)(C.x+g*d.CUBE_SIZE_PX,C.y+_*d.CUBE_SIZE_PX),f(t.currentId+3)(C.x+H*d.CUBE_SIZE_PX,C.y+Ye*d.CUBE_SIZE_PX),f(t.currentId+4)(C.x+Ke*d.CUBE_SIZE_PX,C.y+je*d.CUBE_SIZE_PX)],m=e==="I"?l(r)(1,0)(0,0)(2,0)(3,0):e==="J"?l(i)(1,1)(0,0)(0,1)(2,1):e==="L"?l(o)(1,1)(0,1)(2,1)(2,0):e==="O"?l(c)(0,1)(0,0)(1,0)(1,1):e==="S"?l(s)(1,1)(0,1)(1,0)(2,0):e==="T"?l(a)(1,1)(0,1)(1,0)(2,1):l(u)(1,1)(0,0)(1,0)(2,1);return{rotationAxis:m[0],cubes:m,shape:e,rotationIndex:0}},F=class F{constructor(e,n){h(this,"apply",e=>this.handleCollisions(e));h(this,"validX",e=>{const n=e.piece.cubes.some(o=>o.x+this.x>E.CANVAS_WIDTH-d.CUBE_SIZE_PX),r=e.piece.cubes.some(o=>o.x+this.x<0);return!e.piece.cubes.some(o=>e.staticCubes.some(Nt(o)))&&!r&&!n});h(this,"validY",e=>{const n=e.piece.cubes.some(F.hitBottom),r=e.piece.cubes.some(i=>e.staticCubes.some($e(i)));return!n&&!r});h(this,"handleCollisions",e=>({...e,piece:{...e.piece,cubes:e.piece.cubes.map(n=>({...n,x:n.x+(this.validX(e)?this.x:0),y:n.y+(this.validY(e)?this.y:0)}))}}));this.x=e,this.y=n}};h(F,"hitBottom",e=>e.y>=E.CANVAS_HEIGHT-d.CUBE_SIZE_PX);let x=F;class We{constructor(e){h(this,"apply",e=>e.piece.shape==="O"?e:this.rotatePiece(e));h(this,"rotatePiece",e=>{const n=Kt(this.clockwise?e.piece.rotationIndex+1:e.piece.rotationIndex-1,4),r=e.piece.cubes[0].x,i=e.piece.cubes[0].y,o=e.piece.cubes.map(l=>this.rotateCube(l,this.clockwise)(r,i)),c=o.every(ye(e)),s={...e.piece,cubes:o},a={...e,piece:s};if(c)return a;const u=this.checkOffsets(a)(n);if(u.length>0){const l=u[0],m=l[0]*d.CUBE_SIZE_PX,v=l[1]*d.CUBE_SIZE_PX;return new x(m,v).apply({...a,piece:s})}return e});h(this,"rotateCube",(e,n)=>(r,i)=>{const o=e.x-r,c=e.y-i,s=n?[[0,-1],[1,0]]:[[0,1],[-1,0]],a=s[0][0]*o+s[1][0]*c,u=s[0][1]*o+s[1][1]*c;return{...e,x:a+r,y:u+i}});h(this,"checkOffsets",e=>n=>{const r=te.getOffset(e.piece.shape),i=999;return r.map(c=>{const s=c[e.piece.rotationIndex],a=c[n],u=s[0]-a[0],l=s[1]-a[1];return this.validOffset(e)(u,l)?[u,l]:[i,i]}).filter(c=>c[0]!==i)});h(this,"validOffset",e=>(n,r)=>e.piece.cubes.map(o=>({...o,x:o.x+n*d.CUBE_SIZE_PX,y:o.y+r*d.CUBE_SIZE_PX})).every(ye(e)));this.clockwise=e}}const I=class I{constructor(e){h(this,"apply",e=>{const n={...e,exit:[]},r=I.removeFullRows(n),i=this.previewDrop(r),o=this.autoMoveDown(i),c=I.levelCheck(o);return I.gameOver(c)});h(this,"autoMoveDown",e=>{const n=e.tickProgress+d.TICK_RATE_MS;if(n>=e.fallRateMs){const r=I.filterVerticallyCollided(e),i={...r,tickProgress:0};return new x(0,d.CUBE_SIZE_PX).apply(i)}else return{...e,tickProgress:n}});h(this,"previewDrop",e=>{const n=new qe,r=n.apply(e),i=r.piece,o=i.cubes.map(s=>({id:-1*s.id,x:s.x,y:s.y,colour:"none"}));return{...e,dropPreview:o}});this.elapsed=e}};h(I,"removeFullRows",e=>{const n=l=>e.staticCubes.filter(m=>m.y===l.y).length===d.ROW_WIDTH,r=e.staticCubes.filter(n),i=Math.floor(r.length/d.ROW_WIDTH),o=Math.max(...r.map(l=>l.y)),c=pe(e.staticCubes)(r),s=c.filter(l=>l.y<o),a=s.map(l=>({...l,y:l.y+i*d.CUBE_SIZE_PX})),u=pe(c)(s).concat(a);return{...e,staticCubes:u,exit:e.exit.concat(r),score:e.score+Jt(i),levelProgress:e.levelProgress+i}}),h(I,"filterVerticallyCollided",e=>{const n=e.piece.cubes.some(x.hitBottom),r=e.piece.cubes.some(s=>e.staticCubes.some($e(s)))||n,i=r?e.exit.concat(e.dropPreview):e.exit,o=r?e.staticCubes.concat(e.piece.cubes):e.staticCubes,c={...e.piece,cubes:r?[]:e.piece.cubes};return{...e,piece:c,staticCubes:o,exit:i}}),h(I,"levelCheck",e=>e.levelProgress>=d.LEVEL_GOAL?{...e,level:e.level+1,levelProgress:0,fallRateMs:e.fallRateMs>d.FALL_RATE_LIMIT_MS?d.START_FALL_RATE_MS-25*e.level:e.fallRateMs}:e),h(I,"gameOver",e=>e.staticCubes.filter(r=>r.y<=0).length>0?{...ae,gameEnd:!0,highScore:e.score}:e);let ne=I;class nn{constructor(e){h(this,"apply",e=>this.nextPiece(e));h(this,"nextPiece",e=>e.piece.cubes.length===0?{...e,currentId:e.currentId+d.PIECE_SIZE,piece:e.nextPiece,nextPiece:Ge({...e,currentId:e.currentId+2*d.PIECE_SIZE})(this.shape)}:{...e});this.shape=e}}class rn{constructor(e){h(this,"apply",e=>{const n=this.stream.pipe(ue(Fe,e)),r=n.subscribe(tn(()=>r.unsubscribe()));return n.pipe(Ve(i=>i.gameEnd)),e});this.stream=e}}class qe{constructor(){h(this,"apply",e=>{const n=e.piece.cubes.map(o=>{const c=e.staticCubes.filter(s=>s.x===o.x);return c.length>0?Math.min(...c.map(a=>a.y))-o.y-d.CUBE_SIZE_PX:E.CANVAS_HEIGHT-o.y-d.CUBE_SIZE_PX}),r=Math.min(...n);return new x(0,r).apply(e)})}}const Fe=(t,e)=>e.apply(t);Z(document,"keypress");const on=Ze(d.TICK_RATE_MS).pipe(k(t=>new ne(t))),cn=X("keydown","KeyA",()=>new x(-1*d.CUBE_SIZE_PX,0)),sn=X("keydown","KeyD",()=>new x(d.CUBE_SIZE_PX,0)),un=X("keydown","KeyS",()=>new x(0,d.CUBE_SIZE_PX)),an=X("keydown","Space",()=>new qe),ln=["I","J","L","O","S","T","Z"],fn=new Date().getMilliseconds(),dn=Yt(Ze(1),7)(fn).pipe(k(t=>new nn(ln[Math.floor(Math.abs(t))]))),hn=X("keydown","KeyR",()=>new We(!0)),vn=X("keydown","KeyW",()=>new We(!1)),pn=se(hn,vn),yn=se(cn,sn,un,an);function mn(t=ae){const e=se(on,yn,pn,dn),n=document.querySelector("#restart");Z(n,"click").pipe(k(()=>new rn(e))).pipe(ue(Fe,t)).subscribe(()=>Qt())}function bn(){en(),mn()}typeof window<"u"&&(window.onload=()=>{bn()});
